{% extends 'new_base.html' %}
{% load static %}

{% block css %}

<style>
    .active {
        display: block;
    }

    .hide {
        display: none;
    }
</style>
{% endblock css %}
{% block Dashboard %}
<main class="container-fluid back-color">
    <div class=" p-5 rounded mt-3 ">
        <h1 class='text-center text-light'> <strong>ðŸ‘‹ Welcome</strong></h1>
        <div class="align-center">
        </div>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>

        <form method="POST" action="{% url 'welcome' guild.server_id %}" class="was-validated">
            {% csrf_token %}
            <div class="d-flex bd-highlight mb-3 mt-3 border-top border-secondary ">

                <div class="p-4 bd-highlight align-self-center justify-content-center">
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <h5>
                        <b>
                            Welcome Channel
                        </b>
                    </h5>
                </div>
                <div class="p-2 flex-fill align-self-center bd-highlight">

                </div>
                <div class="ml-auto p-4 align-self-center  justify-content-center bd-highlight">
                    <select class="form-control" name="welcome_channel">
                        {% if welcome_channel %}
                        <option class=' text-light' value={{welcome_channel.id}}>{{welcome_channel.name}}
                        </option>
                        {% endif %}
                        <option class=' text-light' value="">Select Channel</option>
                        {% for channel in text_channel %}
                        <option class=' text-light' value={{channel.id}}>{{channel.name}}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="invalid-feedback">Example invalid custom select feedback</div>
                <div class="valid-tooltip">
                    Looks good!
                </div>
            </div>

            <div class="d-flex  flex-column bd-highlight mt-4 mb-4 border-top border-secondary ">
                <div class="d-flex bd-highlight flex-row mt-4 mb-1  border-secondary ">
                    <div class="p-4 bd-highlight align-self-center justify-content-center">

                        <h5>
                            <b>
                                Welcome Message
                            </b>
                        </h5>
                    </div>
                    <div class="p-2 flex-fill align-self-center bd-highlight">

                    </div>
                    <div class="ml-auto p-4 align-self-end  justify-content-center bd-highlight">

                        <div class="form-check form-switch">
                            {% if welcome.welcome_enable %}
                            <input class="form-check-input" name="welcome_enable" type="checkbox"
                                id="flexSwitchCheckDefault" checked />
                            {% else %}
                            <input class="form-check-input off" name="welcome_enable" type="checkbox"
                                id="flexSwitchCheckDefault" />
                            {% endif %}
                            <label class="form-check-label" for="flexSwitchCheckDefault"></label>
                        </div>
                    </div>
                </div>
                <!-- <div class="d-flex flex-column bd-highlight mb-3"> -->
                <div class="p-1 bd-highlight align-self-start ">
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <b>Example</b><br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;you can set like that welcome announcement
                </div>

                <div class="p-2 bd-highlight">

                    <ul>
                        <li class="clickme btn btn-primary"><a href="javascript:void();" data-tag="one"
                                class="activelink text-center text-light">Embed Message</a></li>
                        <li class="clickme btn btn-primary"><a href="javascript:void();" class="text-center text-light"
                                data-tag="two">Text Message</a></li>
                        <!-- <li class="clickme btn btn-primary"><a href="javascript:void();" data-tag="three">THREE</a></li> -->
                    </ul>
                    <div style="clear: both;"></div>
                    <div id="container">
                        <div class="list" id="one">
                            <div class="text-center">
                                <img class="img-fluid mx-auto " src={% static 'images/screenshot2.png' %}>
                            </div>
                        </div>
                        <div class="list hide" id="two">Coming Soon</div>
                    </div>

                </div>

                <div class="p-2 bd-highlight">
                    <div class="p-1 bd-highlight align-self-start justify-content-center ">
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        <b>Message</b>
                        <br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Set the Welcome Message, This will send a
                        welcome message in welcome channel when a member join.
                    </div>
                </div>
                <div class="p-2 bd-highlight">
                    <div class="form-group">
                        <label for="exampleFormControlTextarea1"></label>
                        {% if welcome.welcome_msg %}
                        <textarea class="form-control  text-dark" name="welcome_message" placeholder="welcome_message"
                            rows="7">{{welcome.welcome_msg}}</textarea>
                        {% else %}
                        <textarea class="form-control text-dark" name="welcome_message" placeholder="welcome_message"
                            rows="3"></textarea>
                        {% endif %}
                    </div>
                </div>

                <div class="p-2 bd-highlight">
                    <div class="p-1 bd-highlight align-self-start justify-content-center ">
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        <b>Welcome Images</b>
                        <br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Set the Welcome images, This will send a
                        welcome image in welcome channel when a member join and <b>You can set upto 5 Images</b>
                    </div>
                </div>
                <div class="p-2 bd-highlight">

                    <div class="form-group">
                        <label for="#"></label>
                        {% if welcome.image1 %}
                        <textarea class="form-control text-dark" name="welcome_images" placeholder="Images Link"
                            rows="3">
{{welcome.image1}}
{{welcome.image2}}
{{welcome.image3}}
{{welcome.image4}}
{{welcome.image5}}</textarea>
                        {% else %}
                        <textarea class="form-control text-dark" name="welcome_images" placeholder="Images Link"
                            rows="3"></textarea>
                        {% endif %}
                    </div>
                </div>
            </div>

            <div class="d-flex  flex-column bd-highlight mt-4 mb-4 border-top border-secondary ">
                <div class="d-flex bd-highlight flex-row mt-4 mb-1  border-secondary ">
                    <div class="p-4 bd-highlight align-self-center justify-content-center">

                        <h5>
                            <b>
                                Self Role
                            </b>
                        </h5>
                    </div>
                    <div class="p-2 flex-fill align-self-center bd-highlight">

                    </div>
                    <div class="ml-auto p-4 align-self-end  justify-content-center bd-highlight">
                        <select class="form-control" name="welcome_role" required>
                            {% if welcome.self_role %}
                            <option value={{welcome_channel.role_id}}>{{welcome_channel.role_name}}</option>
                            {% else %}
                            <option value="None" class="back-color text-light"> <i class="back-color">Select Role</i>
                            </option>
                            {% endif %}
                            {% for role in roles %}
                            <option class=" back-color text-light" value={{role.id}}>{{role.name}}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>


            </div>


            <div class="d-flex bd-highlight mb-5 border-top border-secondary ">
                <div class="ml-auto p-2 align-self-center bd-highlight">
                    <input type='submit' value="Save" class="btn btn-outline-light">
                </div>
            </div>

        </form>
    </div>

</main>
{% endblock Dashboard %}

{% block script %}
<script>
    $(document).ready(function () {
        $('.clickme a').click(function () {
            $('.clickme a').removeClass('activelink');
            $(this).addClass('activelink');
            var tagid = $(this).data('tag');
            $('.list').removeClass('active').addClass('hide');
            $('#' + tagid).addClass('active').removeClass('hide');
        });
    });
    // get cookie
    function getCookie(cname) {
        var name = cname + "=";
        var decodedCookie = decodeURIComponent(document.cookie);
        var ca = decodedCookie.split(';');
        for (var i = 0; i < ca.length; i++) {
            var c = ca[i];
            while (c.charAt(0) == ' ') {
                c = c.substring(1);
            }
            if (c.indexOf(name) == 0) {
                return c.substring(name.length, c.length);
            }
        }
        return "";
    }

    //  check flexSwitchCheckDefault if checked then alert message else alert message
    $(document).ready(function () {

        $('#flexSwitchCheckDefault').change(function () {
            if ($(this).is(":checked")) {
                //alert('checked');
                // send post data to welcome/enable url
                $.ajax({
                    headers: { "X-CSRFToken": getCookie("csrftoken") },
                    type: "POST",
                    url: '/server/{{guild.server_id}}/welcome/enable',
                    data: {
                        'enable': '1'
                    },
                    success: function (data) {
                        //alert('welcome messages are ON');
                        console.log(data);
                    }
                });
            } else {
                //alert('not checked');
                // send post data to welcome/enable url
                $.ajax({
                    headers: { "X-CSRFToken": getCookie("csrftoken") },
                    type: "POST",
                    url: '/server/{{guild.server_id}}/welcome/enable',
                    data: {
                        'enable': 0
                    },
                    success: function (data) {
                        //alert('welcome messages are OFF');
                        // TODO: side bar message
                        console.log(data);
                    }
                });
            }
        });
    });  
</script>
{% endblock script %}